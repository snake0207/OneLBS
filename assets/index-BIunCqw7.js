import{v as te,w as se,x as ne,r as p,f as re,_ as ie,b as Q,j as e,y as le,z as de,B as o,S as Y,T as h,O as Z,Y as ae,d as oe}from"./index-Zwjsjf_e.js";import{b as M,c as L,d as c,e as s,M as ce,a as J}from"./index-CIhg3QXE.js";import{C as xe}from"./index-DDWb-XS6.js";import{d as he,e as je}from"./service-DisLG0W9.js";import{u as pe}from"./formik.esm-DxgWIguA.js";import{D as K}from"./index-BIFGUC3g.js";import{T as V}from"./index-D6lVn7oh.js";import{T as P}from"./index-D9xLZxGV.js";import{h as F,i as z,j as X}from"./service-zx91cxfm.js";import{o as y,C as ue,W as ge,G as me}from"./olleh_map-cJNfxRyM.js";import{d as R}from"./PlaylistAddCheckOutlined-B2F_BeAN.js";import{T as B}from"./TableBody-sjDPsEYM.js";import"./index-DxA-rrMr.js";import"./index-DOeUa9Au.js";import"./TextField-C_ArUhJ2.js";import"./MenuItem-B4bxXtLY.js";import"./Close-DdxGh4K7.js";import"./FormControlLabel-BYqcm0yL.js";import"./InputAdornment-BudvL8JH.js";function fe(t){return te("MuiTableContainer",t)}se("MuiTableContainer",["root"]);const ye=["className","component"],be=t=>{const{classes:l}=t;return de({root:["root"]},fe,l)},Ce=ne("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(t,l)=>l.root})({width:"100%",overflowX:"auto"}),$=p.forwardRef(function(l,d){const i=re({props:l,name:"MuiTableContainer"}),{className:j,component:b="div"}=i,u=ie(i,ye),C=Q({},i,{component:b}),n=be(C);return e.jsx(Ce,Q({ref:d,as:b,className:le(n.root,j),ownerState:C},u))}),k={searchBox:{display:"flex",justifyContent:"space-between",width:"100%",borderRadius:"8px",mb:"10px",p:"16px 20px",backgroundColor:"grey.search",boxShadow:"0 3px 14px rgb(0 0 0 / 24%)"},tableBox:{width:"100%",th:{border:0,color:"text.darkgray",p:"3px 10px 3px 0"},input:{height:"40px",pt:0,pb:0}},searchButton:{fontSize:15,fontWeight:400,width:"69px",height:"40px",minWidth:"auto",backgroundColor:"button.main",padding:"6px"},inputDash:{fontSize:15,display:"flex",alignItems:"center"},cellTitle:{width:"10%"},cellInput:{width:"18%"}};function we({onSearch:t}){const l=pe({initialValues:{startDate:"",endDate:"",start_time:"00",end_time:String(new Date().getHours()),serviceCode:"",opType:"",targetMdn:""},onSubmit:d=>{const i=`${d.startDate.split("-").join("")}${d.start_time}`,j=`${d.endDate.split("-").join("")}${d.end_time}`;t&&t({...d,startDate:i,endDate:j})}});return e.jsx(o,{sx:k.searchBox,children:e.jsx(M,{sx:k.tableBox,children:e.jsxs(L,{children:[e.jsxs(c,{children:[e.jsx(s,{sx:k.cellTitle,children:"조회기간"}),e.jsx(s,{sx:k.cellInput,colSpan:5,children:e.jsxs(Y,{direction:"row",spacing:.1,alignItems:"center",width:"100%",children:[e.jsx(K,{name:"startDate",formik:l}),e.jsx(V,{name:"start_time",formik:l}),e.jsx(h,{children:"~"}),e.jsx(K,{name:"endDate",formik:l}),e.jsx(V,{name:"end_time",formik:l})]})})]}),e.jsxs(c,{children:[e.jsx(s,{sx:k.cellTitle,children:"서비스코드"}),e.jsx(s,{sx:k.cellInput,children:e.jsx(P,{name:"serviceCode",formik:l})}),e.jsx(s,{sx:k.cellTitle,children:"OP Type"}),e.jsx(s,{sx:k.cellInput,children:e.jsx(P,{name:"opType",formik:l})}),e.jsx(s,{sx:k.cellTitle,children:"대상자"}),e.jsx(s,{sx:k.cellInput,children:e.jsx(P,{name:"targetMdn",formik:l})}),e.jsx(s,{align:"right",children:e.jsx(ce,{disabled:!l.values.startDate||!l.values.endDate,name:"search",title:"검색",onClick:l.handleSubmit})})]})]})})})}const Se=[{field:"id",headerName:"ID",flex:.8,renderCell:t=>e.jsx(h,{children:t.row.id})},{field:"center",headerName:"센터",flex:.8,renderCell:t=>e.jsx(h,{color:"primary",children:F[t.row.center]!==void 0?F[t.row.center].label:`${t.row.center} is Unknown`})},{field:"reqDate",headerName:"요청일시",flex:1.5,renderCell:t=>e.jsx(h,{children:t.row.reqDate})},{field:"resDate",headerName:"응답일시",flex:1.5,renderCell:t=>e.jsx(h,{children:t.row.resDate})},{field:"serviceName",headerName:"서비스명",flex:1.2,renderCell:t=>e.jsx(h,{children:t.row.serviceName})},{field:"opType",headerName:"OP Type",flex:1,renderCell:t=>e.jsx(h,{children:t.row.opType})},{field:"reqMdn",headerName:"요청자",flex:1,renderCell:t=>e.jsx(h,{children:t.row.reqMdn})},{field:"targetMdn",headerName:"대상자",flex:1,renderCell:t=>e.jsx(h,{children:t.row.targetMdn})},{field:"posMethod",headerName:"측위 방식",flex:1,renderCell:t=>e.jsx(h,{children:z[t.row.posMethod]!==void 0?z[t.row.posMethod].label:`${t.row.posMethod} is Unknown`})},{field:"result",headerName:"결과",flex:.8,renderCell:t=>e.jsx(h,{children:t.row.result})},{field:"respTime",headerName:"응답시간(초)",flex:1,align:"right",renderCell:t=>e.jsx(h,{children:t.row.respTime})}],ee=({locations:t,onMarkerClick:l,bounceMarker:d={}})=>{const[i,j]=p.useState(null),[b,u]=p.useState([]);let C=0,n=13,g={latitude:t[0].latitude,longitude:t[0].longitude};if(t.length>1){const{minLat:a,maxLat:w,minLon:m,maxLon:I}=y.minMax(t);g={latitude:(a+w)/2,longitude:(m+I)/2},C=y.getDistance(a,m,w,I),n=y.setZoomWithDistance(C)}return p.useEffect(()=>{if(i==null){const a=y.initMap(document.getElementById("map_div"),y.initCenter(g.latitude,g.longitude),n);j(a)}return()=>{j(null),u([])}},[]),p.useEffect(()=>{if(i)if(y.setCenter(i,y.initCenter(g.latitude,g.longitude)),d.latitude>0&&d.longitude>0){y.clearMarker(b);const a=t.filter(m=>m.id!==d.id).map(m=>y.drawMarker(i,m,!1,l)),w=y.drawMarker(i,d,!0,l);u([...a,w]),y.moveCenter(i,d,8)}else{const a=t.map(w=>y.drawMarker(i,w,!1,l));b.length===0&&u(a)}},[l,d,t,i]),e.jsx(e.Fragment,{children:e.jsx("div",{id:"map_div",style:{height:"100%",width:"100%",zIndex:1}})})},Te=()=>{const t=Z(),[l,d]=p.useState(!1),[i,j]=p.useState({count:0,lists:[]}),b={longitude:127.1279874,latitude:37.3998912,title:"KT 분당"},[u,C]=p.useState([b]),[n,g]=p.useState({page:1,limit:parseInt("50")}),{data:a}=he(n,{enabled:l}),w=x=>{j({count:0,lists:[]}),C([]),g({...n,...x,page:1}),d(!0)},m=({row:x})=>{t("/service-status/history/detail",{state:{row:x}})},I=x=>{const _=i.lists.filter(v=>v.id===x);t("/service-status/history/detail",{state:{row:_[0]}})},N=x=>{const _=parseInt("10"),v=(x+1)*_;x>1&&v<=i.count&&v>=i.lists.length&&(g({...n,page:n.page+1}),d(!0))};return p.useEffect(()=>{if(l&&a)if(console.log("apiResult : ",a),d(!1),(a==null?void 0:a.code)==="0000"){const{totalCount:x,lists:_}=a==null?void 0:a.data;j({count:x,lists:[...i.lists,..._]});const v=_.filter(S=>S.latitude&&S.longitude).map(S=>({id:S.id,trId:S.trId,latitude:S.latitude,longitude:S.longitude,title:S.resDate}));C(v)}else C([b])},[a,n]),e.jsxs(o,{children:[e.jsx(J,{title:"서비스 이력 조회"}),e.jsx(we,{onSearch:w}),e.jsxs(o,{sx:{width:"100%",borderRadius:"8px",p:"18px 20px",backgroundColor:"background.contents",boxShadow:"0 3px 14px rgb(0 0 0 / 24%)"},children:[e.jsx(o,{display:"flex",justifyContent:"flex-start",alignItems:"center",children:e.jsx(h,{sx:{fontSize:"14px"},children:`Total Count: ${i.count}`})}),e.jsx(xe,{rows:i==null?void 0:i.lists,rowCount:i==null?void 0:i.count,columns:Se,sort:{field:"id",orderby:"desc"},onPageChange:N,onRowClick:m,pageInit:n.page===1}),e.jsx(o,{sx:{mt:3,width:"100%",height:"400px"},children:!l&&u.length>0&&e.jsx(ee,{locations:[...u],onMarkerClick:x=>I(x)})})]})]})},Ve=Te,D={contentBox:{width:"100%",borderRadius:"8px",p:"18px 20px",backgroundColor:"background.contents",boxShadow:"0 3px 14px rgb(0 0 0 / 24%)"},table_base:{mb:3,th:{pt:1,pb:1,textAlign:"center",border:"1px solid",borderColor:"table.viewTopBorder"},td:{pt:.5,pb:.5,border:"1px solid",borderColor:"table.viewTopBorder"},"& tr:first-of-type":{"& th":{fontSize:"15px",color:"white",textAlign:"center"}}}},ke=({title:t})=>{const l=Z();return e.jsxs(o,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(R,{}),e.jsx(h,{sx:{ml:1,fontSize:"16px",fontWeight:500,color:"text.darkgray"},children:t}),e.jsx(oe,{sx:{align:"right",marginLeft:"auto"},onClick:()=>l(-1)})]})},A=({title:t})=>e.jsxs(o,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(R,{}),e.jsx(h,{sx:{ml:1,fontSize:"16px",fontWeight:500,color:"text.darkgray"},children:t})]}),_e=()=>{var a,w,m,I,N,x,_,v,S,H,W,E,q,G,U;const{state:{row:t}}=ae(),l={latitude:37.3998912,longitude:127.1279874,title:"KT 분당"},[d,i]=p.useState({}),[j,b]=p.useState([]),[u,C]=p.useState(!0),{data:n}=je({trId:t==null?void 0:t.trId},{enabled:u}),g=(r,f)=>f.filter(T=>T.latitude&&T.longitude).map(T=>({...T,id:`${r}_${T.id}`,title:r==="P"?T.algo:r==="B"?`${T.cellid}`:`${T.mac}`}));return p.useEffect(()=>{var r,f,T;if(u&&n){if(console.log("Detail apiResult : ",n),(n==null?void 0:n.code)==="0000"){const O=[...g("P",(r=n==null?void 0:n.data)==null?void 0:r.posList.lists),...g("B",(f=n==null?void 0:n.data)==null?void 0:f.btsList.lists),...g("W",(T=n==null?void 0:n.data)==null?void 0:T.wifiList.lists)];b(Ie=>O)}else b(O=>[l]);C(!1)}},[n]),j.length>0&&console.log("Detail locations : ",j),e.jsxs(o,{children:[e.jsx(J,{title:"측위 결과 상세"}),e.jsxs(o,{sx:D.contentBox,children:[e.jsx(ke,{title:"측위 결과 요약"}),e.jsx(M,{sx:D.table_base,children:e.jsxs(L,{children:[e.jsxs(c,{sx:{backgroundColor:"#009ACC"},children:[e.jsx(s,{sx:{width:"8%"},children:"센터"}),e.jsx(s,{sx:{width:"12%"},children:"요청일시"}),e.jsx(s,{sx:{width:"12%"},children:"응답일시"}),e.jsx(s,{sx:{width:"10%"},children:"서비스"}),e.jsx(s,{sx:{width:"8%"},children:"OP Type"}),e.jsx(s,{sx:{width:"8%"},children:"요청자"}),e.jsx(s,{sx:{width:"8%"},children:"대상자"}),e.jsx(s,{sx:{width:"8%"},children:"측위방식"}),e.jsx(s,{sx:{width:"10%"},children:"단말모델"}),e.jsx(s,{sx:{width:"6%"},children:"결과"}),e.jsx(s,{sx:{width:"8%"},children:"응답(초)"})]}),t!=null&&t.center?e.jsxs(c,{children:[e.jsx(s,{children:F[t==null?void 0:t.center].label}),e.jsx(s,{children:t==null?void 0:t.reqDate}),e.jsx(s,{children:t==null?void 0:t.resDate}),e.jsx(s,{children:t==null?void 0:t.serviceName}),e.jsx(s,{children:t==null?void 0:t.opType}),e.jsx(s,{children:t==null?void 0:t.reqMdn}),e.jsx(s,{children:t==null?void 0:t.targetMdn}),e.jsx(s,{children:z[t==null?void 0:t.posMethod].label}),e.jsx(s,{children:t==null?void 0:t.model}),e.jsx(s,{children:t==null?void 0:t.result}),e.jsx(s,{children:t==null?void 0:t.respTime})]}):e.jsx(c,{children:e.jsx(s,{colSpan:11,align:"center",children:"No data Found"})})]})}),e.jsxs(o,{sx:{width:"100%",display:"flex",justifyContent:"space-between",gap:2},children:[e.jsxs(o,{sx:{width:"45%",display:"flex",flexDirection:"column",justifyContent:"space-between",gap:4},children:[e.jsxs(Y,{direction:"row",spacing:1,sx:{width:"100%"},children:[e.jsxs(o,{sx:{width:"50%"},children:[e.jsx(A,{title:"측위 목록"}),e.jsx($,{component:o,style:{height:200},children:e.jsxs(M,{sx:D.table_base,children:[e.jsx(L,{children:e.jsxs(c,{style:{backgroundColor:"#009ACC"},children:[e.jsx(s,{style:{width:"20%"},children:""}),e.jsx(s,{style:{width:"40%"},children:"측위방식"}),e.jsx(s,{style:{width:"40%"},children:"알고리즘"})]})}),e.jsx(B,{children:(w=(a=n==null?void 0:n.data)==null?void 0:a.posList)!=null&&w.totalCount?(I=(m=n==null?void 0:n.data)==null?void 0:m.posList)==null?void 0:I.lists.map((r,f)=>e.jsxs(c,{onClick:()=>{r.longitude>0&&i({...r,id:`P_${r.id}`})},children:[e.jsxs(s,{style:{textAlign:"center"},children:[r.posMethod==="CELL"&&e.jsx("img",{src:ue,width:"20px",height:"28px",loading:"lazy"}),r.posMethod==="WIFI"&&e.jsx("img",{src:ge,width:"20px",height:"28px",loading:"lazy"}),r.posMethod==="GNSS"&&e.jsx("img",{src:me,width:"20px",height:"28px",loading:"lazy"})]}),e.jsx(s,{children:r.posMethod}),e.jsx(s,{children:r.algo})]},f)):e.jsx(c,{children:e.jsx(s,{colSpan:3,align:"center",children:"No data Found"})})})]})})]}),e.jsxs(o,{sx:{width:"50%"},children:[e.jsx(A,{title:"기지국 목록"}),e.jsx($,{component:o,style:{height:200},children:e.jsxs(M,{sx:D.table_base,children:[e.jsx(L,{children:e.jsxs(c,{sx:{backgroundColor:"#009ACC"},children:[e.jsx(s,{style:{width:"20%"},children:"Type"}),e.jsx(s,{style:{width:"50%"},children:"Cell-ID"}),e.jsx(s,{style:{width:"30%"},children:"Serving"})]})}),e.jsx(B,{children:(x=(N=n==null?void 0:n.data)==null?void 0:N.btsList)!=null&&x.totalCount?(_=n==null?void 0:n.data)==null?void 0:_.btsList.lists.map((r,f)=>e.jsxs(c,{onClick:()=>{r.longitude>0&&i({...r,id:`B_${r.id}`})},children:[e.jsx(s,{children:X[r.network]!==void 0?X[r.network].label:`${r.network} Unknown`}),e.jsx(s,{children:r.cellid}),e.jsx(s,{children:r.serving?"serving":"neighbor"})]},f)):e.jsx(c,{children:e.jsx(s,{colSpan:3,align:"center",children:"No data Found"})})})]})})]})]}),e.jsxs(o,{sx:{width:"100%",height:"200px"},children:[e.jsx(A,{title:"WiFi 목록"}),e.jsx($,{component:o,style:{maxHeight:200},children:e.jsxs(M,{sx:D.table_base,children:[e.jsx(L,{children:e.jsxs(c,{style:{backgroundColor:"#009ACC"},children:[e.jsx(s,{style:{width:"30%"},children:"MAC"}),e.jsx(s,{style:{width:"20%"},children:"SSID"}),e.jsx(s,{style:{width:"10%"},children:"Grade"}),e.jsx(s,{style:{width:"10%"},children:"Band"}),e.jsx(s,{style:{width:"10%"},children:"RSSI"}),e.jsx(s,{style:{width:"20%"},children:"Status"})]})}),e.jsx(B,{children:(S=(v=n==null?void 0:n.data)==null?void 0:v.wifiList)!=null&&S.totalCount?(W=(H=n==null?void 0:n.data)==null?void 0:H.wifiList)==null?void 0:W.lists.map((r,f)=>e.jsxs(c,{onClick:()=>{r.longitude>0&&i({...r,id:`W_${r.id}`})},children:[e.jsx(s,{children:r.mac}),e.jsx(s,{children:r.ssid}),e.jsx(s,{style:{textAlign:"right"},children:r.grade}),e.jsx(s,{style:{textAlign:"right"},children:r.band}),e.jsx(s,{style:{textAlign:"right"},children:r.rssi}),e.jsx(s,{children:r.status})]},f)):e.jsx(c,{children:e.jsx(s,{colSpan:6,align:"center",children:"No data Found"})})})]})})]}),e.jsxs(o,{sx:{width:"100%"},children:[e.jsx(A,{title:"하위 트랜잭션 목록"}),e.jsx($,{style:{maxHeight:300},children:e.jsxs(M,{sx:D.table_base,children:[e.jsx(L,{children:e.jsxs(c,{style:{backgroundColor:"#009ACC"},children:[e.jsx(s,{style:{width:"20%"},children:"시스템"}),e.jsx(s,{style:{width:"20%"},children:"측위방식"}),e.jsx(s,{style:{width:"15%"},children:"응답"}),e.jsx(s,{style:{width:"45%"},children:"메시지 전문"})]})}),e.jsx(B,{children:(q=(E=n==null?void 0:n.data)==null?void 0:E.transList)!=null&&q.totalCount?(U=(G=n==null?void 0:n.data)==null?void 0:G.transList)==null?void 0:U.lists.map((r,f)=>e.jsxs(c,{children:[e.jsx(s,{style:{width:"20%"},children:r.targetSystem}),e.jsx(s,{children:r.posMethod}),e.jsx(s,{children:r.result}),e.jsx(s,{style:{width:"45%"},children:r.messages})]},f)):e.jsx(c,{children:e.jsx(s,{colSpan:4,align:"center",children:"No data Found"})})})]})})]})]}),e.jsx(o,{sx:{width:"55%",mt:5},children:!u&&j.length>0&&e.jsx(ee,{locations:[...j],bounceMarker:d})})]})]})]})},ve=()=>e.jsx(e.Fragment,{children:e.jsx(_e,{})}),Xe=ve;export{Xe as ServiceHistoryDetailPage,Ve as ServiceHistoryPage};
