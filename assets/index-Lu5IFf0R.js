import{v as e,w as t,x as i,r as l,f as s,_ as n,b as r,j as d,y as o,z as a,B as x,S as c,T as h,O as j,Y as u,d as p}from"./index-CtGT7pB0.js";import{b as m,c as g,d as w,e as f,M as v,a as b}from"./index-CkwR4aEQ.js";import{C}from"./index-VIunMvyj.js";import{d as y,e as k}from"./service-zn3oAYvt.js";import{u as S}from"./formik.esm-DAidWDL1.js";import{D as M}from"./index--uCOVDIp.js";import{T}from"./index-DlwK5QFR.js";import{T as D}from"./index-Ddq0Ofe6.js";import{h as I,i as N,j as _}from"./service-Dw05zt6F.js";import{o as L,C as B,W as $,G as A}from"./olleh_map-cbgdSS3j.js";import{d as z}from"./PlaylistAddCheckOutlined-DFeGMwqg.js";import{T as F}from"./TableBody-D_BRbEmt.js";import"./index-C6TEBvmk.js";import"./index-DE0F4aPm.js";import"./TextField-D-bOuL6E.js";import"./MenuItem-BYlXn1lz.js";import"./Close-CTx8nZBT.js";import"./FormControlLabel-CIx-0vjk.js";import"./InputAdornment-CN7O440v.js";function P(t){return e("MuiTableContainer",t)}t("MuiTableContainer",["root"]);const W=["className","component"],R=i("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(e,t)=>t.root})({width:"100%",overflowX:"auto"}),q=l.forwardRef((function(e,t){const i=s({props:e,name:"MuiTableContainer"}),{className:l,component:x="div"}=i,c=n(i,W),h=r({},i,{component:x}),j=(e=>{const{classes:t}=e;return a({root:["root"]},P,t)})(h);return d.jsx(R,r({ref:t,as:x,className:o(j.root,l),ownerState:h},c))})),E={searchBox:{display:"flex",justifyContent:"space-between",width:"100%",borderRadius:"8px",mb:"10px",p:"16px 20px",backgroundColor:"grey.search",boxShadow:"0 3px 14px rgb(0 0 0 / 24%)"},tableBox:{width:"100%",th:{border:0,color:"text.darkgray",p:"3px 10px 3px 0"},input:{height:"40px",pt:0,pb:0}},searchButton:{fontSize:15,fontWeight:400,width:"69px",height:"40px",minWidth:"auto",backgroundColor:"button.main",padding:"6px"},inputDash:{fontSize:15,display:"flex",alignItems:"center"},cellTitle:{width:"10%"},cellInput:{width:"18%"}};function H({onSearch:e}){const t=S({initialValues:{startDate:"",endDate:"",start_time:"00",end_time:String((new Date).getHours()),serviceCode:"",opType:"",targetMdn:""},onSubmit:t=>{const i=`${t.startDate.split("-").join("")}${t.start_time}`,l=`${t.endDate.split("-").join("")}${t.end_time}`;e&&e({...t,startDate:i,endDate:l})}});return d.jsx(x,{sx:E.searchBox,children:d.jsx(m,{sx:E.tableBox,children:d.jsxs(g,{children:[d.jsxs(w,{children:[d.jsx(f,{sx:E.cellTitle,children:"조회기간"}),d.jsx(f,{sx:E.cellInput,colSpan:5,children:d.jsxs(c,{direction:"row",spacing:.1,alignItems:"center",width:"100%",children:[d.jsx(M,{name:"startDate",formik:t}),d.jsx(T,{name:"start_time",formik:t}),d.jsx(h,{children:"~"}),d.jsx(M,{name:"endDate",formik:t}),d.jsx(T,{name:"end_time",formik:t})]})})]}),d.jsxs(w,{children:[d.jsx(f,{sx:E.cellTitle,children:"서비스코드"}),d.jsx(f,{sx:E.cellInput,children:d.jsx(D,{name:"serviceCode",formik:t})}),d.jsx(f,{sx:E.cellTitle,children:"OP Type"}),d.jsx(f,{sx:E.cellInput,children:d.jsx(D,{name:"opType",formik:t})}),d.jsx(f,{sx:E.cellTitle,children:"대상자"}),d.jsx(f,{sx:E.cellInput,children:d.jsx(D,{name:"targetMdn",formik:t})}),d.jsx(f,{align:"right",children:d.jsx(v,{disabled:!t.values.startDate||!t.values.endDate,name:"search",title:"검색",onClick:t.handleSubmit})})]})]})})})}const O=[{field:"id",headerName:"ID",flex:.8,renderCell:e=>d.jsx(h,{children:e.row.id})},{field:"center",headerName:"센터",flex:.8,renderCell:e=>d.jsx(h,{color:"primary",children:void 0!==I[e.row.center]?I[e.row.center].label:`${e.row.center} is Unknown`})},{field:"reqDate",headerName:"요청일시",flex:1.5,renderCell:e=>d.jsx(h,{children:e.row.reqDate})},{field:"resDate",headerName:"응답일시",flex:1.5,renderCell:e=>d.jsx(h,{children:e.row.resDate})},{field:"serviceName",headerName:"서비스명",flex:1.2,renderCell:e=>d.jsx(h,{children:e.row.serviceName})},{field:"opType",headerName:"OP Type",flex:1,renderCell:e=>d.jsx(h,{children:e.row.opType})},{field:"reqMdn",headerName:"요청자",flex:1,renderCell:e=>d.jsx(h,{children:e.row.reqMdn})},{field:"targetMdn",headerName:"대상자",flex:1,renderCell:e=>d.jsx(h,{children:e.row.targetMdn})},{field:"posMethod",headerName:"측위 방식",flex:1,renderCell:e=>d.jsx(h,{children:void 0!==N[e.row.posMethod]?N[e.row.posMethod].label:`${e.row.posMethod} is Unknown`})},{field:"result",headerName:"결과",flex:.8,renderCell:e=>d.jsx(h,{children:e.row.result})},{field:"respTime",headerName:"응답시간(초)",flex:1,align:"right",renderCell:e=>d.jsx(h,{children:e.row.respTime})}],G=({locations:e,onMarkerClick:t,bounceMarker:i={}})=>{const[s,n]=l.useState(null),[r,o]=l.useState([]);let a=0,x=13,c={latitude:e[0].latitude,longitude:e[0].longitude};if(e.length>1){const{minLat:t,maxLat:i,minLon:l,maxLon:s}=L.minMax(e);c={latitude:(t+i)/2,longitude:(l+s)/2},a=L.getDistance(t,l,i,s),x=L.setZoomWithDistance(a)}return l.useEffect((()=>{if(null==s){const e=L.initMap(document.getElementById("map_div"),L.initCenter(c.latitude,c.longitude),x);n(e)}return()=>{n(null),o([])}}),[]),l.useEffect((()=>{if(s)if(L.setCenter(s,L.initCenter(c.latitude,c.longitude)),i.latitude>0&&i.longitude>0){L.clearMarker(r);const l=e.filter((e=>e.id!==i.id)).map((e=>L.drawMarker(s,e,!1,t))),n=L.drawMarker(s,i,!0,t);o([...l,n]),L.moveCenter(s,i,8)}else{const i=e.map((e=>L.drawMarker(s,e,!1,t)));0===r.length&&o(i)}}),[t,i,e,s]),d.jsx(d.Fragment,{children:d.jsx("div",{id:"map_div",style:{height:"100%",width:"100%",zIndex:1}})})},U=()=>{const e=j(),[t,i]=l.useState(!1),[s,n]=l.useState({count:0,lists:[]}),r={longitude:127.1279874,latitude:37.3998912,title:"KT 분당"},[o,a]=l.useState([r]),[c,u]=l.useState({page:1,limit:parseInt("50")}),{data:p}=y(c,{enabled:t});return l.useEffect((()=>{if(t&&p)if(i(!1),"0000"===(null==p?void 0:p.code)){const{totalCount:e,lists:t}=null==p?void 0:p.data;n({count:e,lists:[...s.lists,...t]});const i=t.filter((e=>e.latitude&&e.longitude)).map((e=>({id:e.id,trId:e.trId,latitude:e.latitude,longitude:e.longitude,title:e.resDate})));a(i)}else a([r])}),[p,c]),d.jsxs(x,{children:[d.jsx(b,{title:"서비스 이력 조회"}),d.jsx(H,{onSearch:e=>{n({count:0,lists:[]}),a([]),u({...c,...e,page:1}),i(!0)}}),d.jsxs(x,{sx:{width:"100%",borderRadius:"8px",p:"18px 20px",backgroundColor:"background.contents",boxShadow:"0 3px 14px rgb(0 0 0 / 24%)"},children:[d.jsx(x,{display:"flex",justifyContent:"flex-start",alignItems:"center",children:d.jsx(h,{sx:{fontSize:"14px"},children:`Total Count: ${s.count}`})}),d.jsx(C,{rows:null==s?void 0:s.lists,rowCount:null==s?void 0:s.count,columns:O,sort:{field:"id",orderby:"desc"},onPageChange:e=>{const t=(e+1)*parseInt("10");e>1&&t<=s.count&&t>=s.lists.length&&(u({...c,page:c.page+1}),i(!0))},onRowClick:({row:t})=>{e("/service-status/history/detail",{state:{row:t}})},pageInit:1===c.page}),d.jsx(x,{sx:{mt:3,width:"100%",height:"400px"},children:!t&&o.length>0&&d.jsx(G,{locations:[...o],onMarkerClick:t=>(t=>{const i=s.lists.filter((e=>e.id===t));e("/service-status/history/detail",{state:{row:i[0]}})})(t)})})]})]})},K={contentBox:{width:"100%",borderRadius:"8px",p:"18px 20px",backgroundColor:"background.contents",boxShadow:"0 3px 14px rgb(0 0 0 / 24%)"},table_base:{mb:3,th:{pt:1,pb:1,textAlign:"center",border:"1px solid",borderColor:"table.viewTopBorder"},td:{pt:.5,pb:.5,border:"1px solid",borderColor:"table.viewTopBorder"},"& tr:first-of-type":{"& th":{fontSize:"15px",color:"white",textAlign:"center"}}}},V=({title:e})=>{const t=j();return d.jsxs(x,{display:"flex",alignItems:"center",mb:2,children:[d.jsx(z,{}),d.jsx(h,{sx:{ml:1,fontSize:"16px",fontWeight:500,color:"text.darkgray"},children:e}),d.jsx(p,{sx:{align:"right",marginLeft:"auto"},onClick:()=>t(-1)})]})},X=({title:e})=>d.jsxs(x,{display:"flex",alignItems:"center",mb:2,children:[d.jsx(z,{}),d.jsx(h,{sx:{ml:1,fontSize:"16px",fontWeight:500,color:"text.darkgray"},children:e})]}),Y=()=>{var e,t,i,s,n,r,o,a,h,j,p,v,C,y,S;const{state:{row:M}}=u(),T={latitude:37.3998912,longitude:127.1279874,title:"KT 분당"},[D,L]=l.useState({}),[z,P]=l.useState([]),[W,R]=l.useState(!0),{data:E}=k({trId:null==M?void 0:M.trId},{enabled:W}),H=(e,t)=>t.filter((e=>e.latitude&&e.longitude)).map((t=>({...t,id:`${e}_${t.id}`,title:"P"===e?t.algo:"B"===e?`${t.cellid}`:`${t.mac}`})));return l.useEffect((()=>{var e,t,i;if(W&&E){if("0000"===(null==E?void 0:E.code)){const l=[...H("P",null==(e=null==E?void 0:E.data)?void 0:e.posList.lists),...H("B",null==(t=null==E?void 0:E.data)?void 0:t.btsList.lists),...H("W",null==(i=null==E?void 0:E.data)?void 0:i.wifiList.lists)];P((e=>l))}else P((e=>[T]));R(!1)}}),[E]),z.length,d.jsxs(x,{children:[d.jsx(b,{title:"측위 결과 상세"}),d.jsxs(x,{sx:K.contentBox,children:[d.jsx(V,{title:"측위 결과 요약"}),d.jsx(m,{sx:K.table_base,children:d.jsxs(g,{children:[d.jsxs(w,{sx:{backgroundColor:"#009ACC"},children:[d.jsx(f,{sx:{width:"8%"},children:"센터"}),d.jsx(f,{sx:{width:"12%"},children:"요청일시"}),d.jsx(f,{sx:{width:"12%"},children:"응답일시"}),d.jsx(f,{sx:{width:"10%"},children:"서비스"}),d.jsx(f,{sx:{width:"8%"},children:"OP Type"}),d.jsx(f,{sx:{width:"8%"},children:"요청자"}),d.jsx(f,{sx:{width:"8%"},children:"대상자"}),d.jsx(f,{sx:{width:"8%"},children:"측위방식"}),d.jsx(f,{sx:{width:"10%"},children:"단말모델"}),d.jsx(f,{sx:{width:"6%"},children:"결과"}),d.jsx(f,{sx:{width:"8%"},children:"응답(초)"})]}),(null==M?void 0:M.center)?d.jsxs(w,{children:[d.jsx(f,{children:I[null==M?void 0:M.center].label}),d.jsx(f,{children:null==M?void 0:M.reqDate}),d.jsx(f,{children:null==M?void 0:M.resDate}),d.jsx(f,{children:null==M?void 0:M.serviceName}),d.jsx(f,{children:null==M?void 0:M.opType}),d.jsx(f,{children:null==M?void 0:M.reqMdn}),d.jsx(f,{children:null==M?void 0:M.targetMdn}),d.jsx(f,{children:N[null==M?void 0:M.posMethod].label}),d.jsx(f,{children:null==M?void 0:M.model}),d.jsx(f,{children:null==M?void 0:M.result}),d.jsx(f,{children:null==M?void 0:M.respTime})]}):d.jsx(w,{children:d.jsx(f,{colSpan:11,align:"center",children:"No data Found"})})]})}),d.jsxs(x,{sx:{width:"100%",display:"flex",justifyContent:"space-between",gap:2},children:[d.jsxs(x,{sx:{width:"45%",display:"flex",flexDirection:"column",justifyContent:"space-between",gap:4},children:[d.jsxs(c,{direction:"row",spacing:1,sx:{width:"100%"},children:[d.jsxs(x,{sx:{width:"50%"},children:[d.jsx(X,{title:"측위 목록"}),d.jsx(q,{component:x,style:{height:200},children:d.jsxs(m,{sx:K.table_base,children:[d.jsx(g,{children:d.jsxs(w,{style:{backgroundColor:"#009ACC"},children:[d.jsx(f,{style:{width:"20%"},children:""}),d.jsx(f,{style:{width:"40%"},children:"측위방식"}),d.jsx(f,{style:{width:"40%"},children:"알고리즘"})]})}),d.jsx(F,{children:(null==(t=null==(e=null==E?void 0:E.data)?void 0:e.posList)?void 0:t.totalCount)?null==(s=null==(i=null==E?void 0:E.data)?void 0:i.posList)?void 0:s.lists.map(((e,t)=>d.jsxs(w,{onClick:()=>{e.longitude>0&&L({...e,id:`P_${e.id}`})},children:[d.jsxs(f,{style:{textAlign:"center"},children:["CELL"===e.posMethod&&d.jsx("img",{src:B,width:"20px",height:"28px",loading:"lazy"}),"WIFI"===e.posMethod&&d.jsx("img",{src:$,width:"20px",height:"28px",loading:"lazy"}),"GNSS"===e.posMethod&&d.jsx("img",{src:A,width:"20px",height:"28px",loading:"lazy"})]}),d.jsx(f,{children:e.posMethod}),d.jsx(f,{children:e.algo})]},t))):d.jsx(w,{children:d.jsx(f,{colSpan:3,align:"center",children:"No data Found"})})})]})})]}),d.jsxs(x,{sx:{width:"50%"},children:[d.jsx(X,{title:"기지국 목록"}),d.jsx(q,{component:x,style:{height:200},children:d.jsxs(m,{sx:K.table_base,children:[d.jsx(g,{children:d.jsxs(w,{sx:{backgroundColor:"#009ACC"},children:[d.jsx(f,{style:{width:"20%"},children:"Type"}),d.jsx(f,{style:{width:"50%"},children:"Cell-ID"}),d.jsx(f,{style:{width:"30%"},children:"Serving"})]})}),d.jsx(F,{children:(null==(r=null==(n=null==E?void 0:E.data)?void 0:n.btsList)?void 0:r.totalCount)?null==(o=null==E?void 0:E.data)?void 0:o.btsList.lists.map(((e,t)=>d.jsxs(w,{onClick:()=>{e.longitude>0&&L({...e,id:`B_${e.id}`})},children:[d.jsx(f,{children:void 0!==_[e.network]?_[e.network].label:`${e.network} Unknown`}),d.jsx(f,{children:e.cellid}),d.jsx(f,{children:e.serving?"serving":"neighbor"})]},t))):d.jsx(w,{children:d.jsx(f,{colSpan:3,align:"center",children:"No data Found"})})})]})})]})]}),d.jsxs(x,{sx:{width:"100%",height:"200px"},children:[d.jsx(X,{title:"WiFi 목록"}),d.jsx(q,{component:x,style:{maxHeight:200},children:d.jsxs(m,{sx:K.table_base,children:[d.jsx(g,{children:d.jsxs(w,{style:{backgroundColor:"#009ACC"},children:[d.jsx(f,{style:{width:"30%"},children:"MAC"}),d.jsx(f,{style:{width:"20%"},children:"SSID"}),d.jsx(f,{style:{width:"10%"},children:"Grade"}),d.jsx(f,{style:{width:"10%"},children:"Band"}),d.jsx(f,{style:{width:"10%"},children:"RSSI"}),d.jsx(f,{style:{width:"20%"},children:"Status"})]})}),d.jsx(F,{children:(null==(h=null==(a=null==E?void 0:E.data)?void 0:a.wifiList)?void 0:h.totalCount)?null==(p=null==(j=null==E?void 0:E.data)?void 0:j.wifiList)?void 0:p.lists.map(((e,t)=>d.jsxs(w,{onClick:()=>{e.longitude>0&&L({...e,id:`W_${e.id}`})},children:[d.jsx(f,{children:e.mac}),d.jsx(f,{children:e.ssid}),d.jsx(f,{style:{textAlign:"right"},children:e.grade}),d.jsx(f,{style:{textAlign:"right"},children:e.band}),d.jsx(f,{style:{textAlign:"right"},children:e.rssi}),d.jsx(f,{children:e.status})]},t))):d.jsx(w,{children:d.jsx(f,{colSpan:6,align:"center",children:"No data Found"})})})]})})]}),d.jsxs(x,{sx:{width:"100%"},children:[d.jsx(X,{title:"하위 트랜잭션 목록"}),d.jsx(q,{style:{maxHeight:300},children:d.jsxs(m,{sx:K.table_base,children:[d.jsx(g,{children:d.jsxs(w,{style:{backgroundColor:"#009ACC"},children:[d.jsx(f,{style:{width:"20%"},children:"시스템"}),d.jsx(f,{style:{width:"20%"},children:"측위방식"}),d.jsx(f,{style:{width:"15%"},children:"응답"}),d.jsx(f,{style:{width:"45%"},children:"메시지 전문"})]})}),d.jsx(F,{children:(null==(C=null==(v=null==E?void 0:E.data)?void 0:v.transList)?void 0:C.totalCount)?null==(S=null==(y=null==E?void 0:E.data)?void 0:y.transList)?void 0:S.lists.map(((e,t)=>d.jsxs(w,{children:[d.jsx(f,{style:{width:"20%"},children:e.targetSystem}),d.jsx(f,{children:e.posMethod}),d.jsx(f,{children:e.result}),d.jsx(f,{style:{width:"45%"},children:e.messages})]},t))):d.jsx(w,{children:d.jsx(f,{colSpan:4,align:"center",children:"No data Found"})})})]})})]})]}),d.jsx(x,{sx:{width:"55%",mt:5},children:!W&&z.length>0&&d.jsx(G,{locations:[...z],bounceMarker:D})})]})]})]})},Z=()=>d.jsx(d.Fragment,{children:d.jsx(Y,{})});export{Z as ServiceHistoryDetailPage,U as ServiceHistoryPage};
